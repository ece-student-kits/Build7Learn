"use strict";(globalThis.webpackChunkstm_32_documentaion=globalThis.webpackChunkstm_32_documentaion||[]).push([[9166],{2698(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"STM32/ServoMotor/Code","title":"Code","description":"Task: To interface Servo Motor with STM32","source":"@site/docs/STM32/ServoMotor/Code.md","sourceDirName":"STM32/ServoMotor","slug":"/STM32/ServoMotor/Code","permalink":"/Build7Learn/docs/STM32/ServoMotor/Code","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/STM32/ServoMotor/Code.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"ServoMotor","permalink":"/Build7Learn/docs/STM32/ServoMotor/"},"next":{"title":"16x2 I2C_LCD Display","permalink":"/Build7Learn/docs/STM32/LCD_Display/"}}');var t=s(4848),r=s(8453);const o={},c="Code",l={},d=[{value:"Step 1: Create a STM32 Project &quot;Servo&quot;",id:"step-1-create-a-stm32-project-servo",level:3},{value:"Step 2: Clock Configuration",id:"step-2-clock-configuration",level:3},{value:"Step 3: Pinout &amp; Configuration",id:"step-3-pinout--configuration",level:3},{value:"Timer Configuration- TIM2",id:"timer-configuration--tim2",level:4},{value:"Step 4: Code Snippet to Control Servo Rotation",id:"step-4-code-snippet-to-control-servo-rotation",level:3}];function a(e){const n={code:"code",h1:"h1",h3:"h3",h4:"h4",header:"header",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"code",children:"Code"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"Task: To interface Servo Motor with STM32"})}),"\n",(0,t.jsx)(n.h3,{id:"step-1-create-a-stm32-project-servo",children:'Step 1: Create a STM32 Project "Servo"'}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"step-2-clock-configuration",children:"Step 2: Clock Configuration"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Select ",(0,t.jsx)(n.code,{children:"HSE"})," in the ",(0,t.jsx)(n.strong,{children:"PLL Source Mux"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Select ",(0,t.jsx)(n.code,{children:"PLLCLK"})," in the ",(0,t.jsx)(n.strong,{children:"System Clock Mux"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.strong,{children:"HCLK (MHz)"})," is set at ",(0,t.jsx)(n.code,{children:"180"})," Mhz, and press Enter"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["After the clock is initialized, select the ",(0,t.jsx)(n.strong,{children:"APB1 Prescaler"})," as ",(0,t.jsx)(n.code,{children:"/8"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["We use the ",(0,t.jsx)(n.strong,{children:"TIM2"})," for the ",(0,t.jsx)(n.strong,{children:"PWM"}),", which is connected to the APB1 Bus"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.strong,{children:"APB1 Timer clock"})," is at ",(0,t.jsx)(n.strong,{children:"45 MHz"})," right now"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Image",src:s(8230).A+"",width:"1395",height:"487"})}),"\n",(0,t.jsx)(n.h3,{id:"step-3-pinout--configuration",children:"Step 3: Pinout & Configuration"}),"\n",(0,t.jsx)(n.h4,{id:"timer-configuration--tim2",children:"Timer Configuration- TIM2"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Image",src:s(9093).A+"",width:"975",height:"557"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Mode:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Set the ",(0,t.jsx)(n.strong,{children:"Clock source"})," as ",(0,t.jsx)(n.code,{children:"internal clock"}),", which is at 45 MHz (same as APB1)"]}),"\n",(0,t.jsxs)(n.li,{children:["Select the ",(0,t.jsx)(n.code,{children:"PWM channel"})," for the Timer, in ",(0,t.jsx)(n.strong,{children:"Channel 1"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Configuration:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Under parameter settings:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Set ",(0,t.jsx)(n.strong,{children:"Prescalar"})," value as ",(0,t.jsx)(n.code,{children:"90-1"})]}),"\n",(0,t.jsxs)(n.li,{children:["Set ",(0,t.jsx)(n.strong,{children:"Counter Period"})," as ",(0,t.jsx)(n.code,{children:"10000-1"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Pinout:"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Image",src:s(1546).A+"",width:"1009",height:"463"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Set Pin ",(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"PA0"})})," as the ",(0,t.jsx)(n.strong,{children:"PWM output"})," Pin and we will connect it to the Servo Motor Signal pin."]}),"\n",(0,t.jsxs)(n.li,{children:["The output Frequency of the PWM signal depends on 3 parameters- ",(0,t.jsx)(n.strong,{children:"Timer Clock, ARR and Prescaler"})]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"step-4-code-snippet-to-control-servo-rotation",children:"Step 4: Code Snippet to Control Servo Rotation"}),"\n",(0,t.jsxs)(n.p,{children:["Paste the following code snippet inside the ",(0,t.jsx)(n.code,{children:"/* USER CODE BEGIN PFP */"})," in ",(0,t.jsx)(n.code,{children:"main.c"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-c",children:"int angle(int val);\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Paste the following code snippet inside the ",(0,t.jsx)(n.code,{children:"/* USER CODE BEGIN 2 */"})," in ",(0,t.jsx)(n.code,{children:"main.c"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-c",children:"HAL_TIM_PWM_Start(&htim2, TIM_CHANNEL_1);\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Paste the following code snippet inside the ",(0,t.jsx)(n.code,{children:"While (1)"})," in ",(0,t.jsx)(n.code,{children:"main.c"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-c",children:"__HAL_TIM_SET_COMPARE(&htim2,TIM_CHANNEL_1, angle(0));\nHAL_Delay(1000);\n__HAL_TIM_SET_COMPARE(&htim2,TIM_CHANNEL_1, angle(90));\nHAL_Delay(1000);\n__HAL_TIM_SET_COMPARE(&htim2,TIM_CHANNEL_1, angle(180));\nHAL_Delay(1000);\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Paste the following code snippet inside the ",(0,t.jsx)(n.code,{children:"/* USER CODE BEGIN 4 */"})," in ",(0,t.jsx)(n.code,{children:"main.c"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-c",children:"int angle(int val){\n\tint per_deg = 5.55;  //pulse value for 1\xb0 Rotation\n\tint pulse = 250 + (val * per_deg);  // calculate pulse value, starting from 25\n\treturn pulse;\n}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},8230(e,n,s){s.d(n,{A:()=>i});const i=s.p+"assets/images/3-a9d6def4d40a187fd228899ab8b3dc4e.png"},9093(e,n,s){s.d(n,{A:()=>i});const i=s.p+"assets/images/8-7b6c65f5be398be47774c6dc8c0be775.png"},1546(e,n,s){s.d(n,{A:()=>i});const i=s.p+"assets/images/Servo-a3287f7a1636aa12916dd8f848df0697.png"},8453(e,n,s){s.d(n,{R:()=>o,x:()=>c});var i=s(6540);const t={},r=i.createContext(t);function o(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);