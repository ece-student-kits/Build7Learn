"use strict";(globalThis.webpackChunkstm_32_documentaion=globalThis.webpackChunkstm_32_documentaion||[]).push([[9489],{2659(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"STM32/CustomProjects/RoomAutomation","title":"RoomAutomation","description":"- This project is the combination of several modules","source":"@site/docs/STM32/CustomProjects/RoomAutomation.md","sourceDirName":"STM32/CustomProjects","slug":"/STM32/CustomProjects/RoomAutomation","permalink":"/Build7Learn/docs/STM32/CustomProjects/RoomAutomation","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/STM32/CustomProjects/RoomAutomation.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Code","permalink":"/Build7Learn/docs/STM32/UltrasonicSensor/code"}}');var o=t(4848),s=t(8453);const l={},r="RoomAutomation",c={},d=[{value:"Steps to Implement this Project",id:"steps-to-implement-this-project",level:3},{value:"Pinout &amp; Clock Config",id:"pinout--clock-config",level:3},{value:"Code",id:"code",level:3}];function a(e){const n={code:"code",h1:"h1",h3:"h3",header:"header",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"roomautomation",children:"RoomAutomation"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"This project is the combination of several modules"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"LCD Room Temperature Display:"})," Temperature Sensor(LM35)  --\x3e  LCD_Display"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Automatic Door Control:"})," IR Sensor(detect Obstacle)  --\x3e  Servo(180 degrees/0 degrees) [Open/Close Door]"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Automated Night Lamp:"})," LDR Module(Detect absence of Light)  --\x3e  Relay controlled Night Lamp"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["In addition to the modules learned, I have additionally included ",(0,o.jsx)(n.code,{children:"HAL_GetTick()"})," function to implement ",(0,o.jsx)(n.code,{children:"Non-Blocking Delay"})," instead of ",(0,o.jsx)(n.code,{children:"HAL_Delay()"})," function which is Blocking"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h3,{id:"steps-to-implement-this-project",children:"Steps to Implement this Project"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Initialize the Clock as per the steps in Servo module in the Docs"}),"\n",(0,o.jsx)(n.li,{children:"Initialize LCD Display pins and logic by following the procedures in the LCD Display module in the Docs"}),"\n",(0,o.jsx)(n.li,{children:"Configure PWM and timer, for Servo control reffering the Servo module in Docs"}),"\n",(0,o.jsx)(n.li,{children:"Initialize ADC by following the AnalogSensors: LM35 module procedures in the Docs"}),"\n",(0,o.jsx)(n.li,{children:"Initialize the pins and logic of IR Sensor and LDR Module by reffering the procedures of DigitalSenors: IR_LED module in the Docs"}),"\n",(0,o.jsx)(n.li,{children:"Use Non-Blocking delay instead of Blocking delay as stated above in the logic requirement after generating the code"}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h3,{id:"pinout--clock-config",children:"Pinout & Clock Config"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Clock Config"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"Image",src:t(8230).A+"",width:"1395",height:"487"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Pinout"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"Image",src:t(7020).A+"",width:"443",height:"387"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"PA0"})," as ",(0,o.jsx)(n.code,{children:"ADC1_IN0"})," (LM35)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"PA1"})," as ",(0,o.jsx)(n.code,{children:"TIM2_CH2"})," (Servo)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"PA6"})," as ",(0,o.jsx)(n.code,{children:"GPIO Input"})," (IR_Sensor)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"PB10"})," as ",(0,o.jsx)(n.code,{children:"GPIO Output"})," (RelayBulb)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"PA8"})," as ",(0,o.jsx)(n.code,{children:"GPIO Input"})," (LDR)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"PB8"})," as ",(0,o.jsx)(n.code,{children:"I2C1_SCL"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"PB9"})," as ",(0,o.jsx)(n.code,{children:"I2C1_SDA"})]}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h3,{id:"code",children:"Code"}),"\n",(0,o.jsxs)(n.p,{children:["Paste the following code snippet inside the ",(0,o.jsx)(n.code,{children:"/* USER CODE BEGIN Includes */"})," in ",(0,o.jsx)(n.code,{children:"main."}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-c",children:'#include "stdio.h"\n#include "liquidcrystal_i2c.h"\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Paste the following code snippet inside the ",(0,o.jsx)(n.code,{children:"/* USER CODE BEGIN PV */"})," in ",(0,o.jsx)(n.code,{children:"main.c"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-c",children:"uint32_t previousTime = 0;  // for non-blocking delay in main loop\nuint32_t ledPreviousTime = 0; // for LED control delay\nuint32_t servoPreviousTime = 0; // for Servo control delay\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Paste the following code snippet inside the ",(0,o.jsx)(n.code,{children:"/* USER CODE BEGIN PFP */"})," in ",(0,o.jsx)(n.code,{children:"main.c"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-c",children:"int angle(int val);\nvoid door();\nvoid light();\nvoid temp();\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Paste the following code snippet inside the ",(0,o.jsx)(n.code,{children:"/* USER CODE BEGIN 2 */"})," in ",(0,o.jsx)(n.code,{children:"main.c"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-c",children:"  HAL_TIM_PWM_Start(&htim2, TIM_CHANNEL_2);\n\n  LCD_Init(2);\n  LCD_NoCursor();\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Paste the following code snippet inside the ",(0,o.jsx)(n.code,{children:"/* USER CODE BEGIN 3 */"})," in ",(0,o.jsx)(n.code,{children:"while(1)"})," under ",(0,o.jsx)(n.code,{children:"main.c"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-c",children:"   temp();\n   light();\n   door();\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Paste the following code snippet inside the ",(0,o.jsx)(n.code,{children:"/* USER CODE BEGIN 4 */"})," in ",(0,o.jsx)(n.code,{children:"main.c"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-c",children:'int angle(int val){\n\tint per_deg = 5.55;  //pulse value for 1\xb0 Rotation\n\tint pulse = 250 + (val * per_deg);  // calculate pulse value, starting from 25\n\treturn pulse;\n}\n\nvoid temp(){\n\t  // adc_value variable store the adc value,\n\t  // value variable store the temperature value\n\t  int adc_value, value;\n\t  // store the converted voltage value from analog value\n\t  float voltage;\n\n\t  int calibration_offset = 20;  // Calibrate the difference between measured temperature and actual temperature\n\n\t  int calibration_factor = 100; //10 mV per \xb0C, the factor will be 100 (1V = 1000 mV)\n    // start ADC convertion\n\t  HAL_ADC_Start(&hadc1);\n\t  HAL_ADC_PollForConversion(&hadc1, 100);\n\t  adc_value = HAL_ADC_GetValue(&hadc1);\n\t  HAL_ADC_Stop(&hadc1);\n\n\t  if (HAL_GetTick() - previousTime >= 3000) {\n\t\t  previousTime = HAL_GetTick();\n\t\t  voltage = (adc_value * 3.3) / 4096;\n\t\t  value = (voltage * calibration_factor) - calibration_offset;\n\n\t\t  char message[20];\n\t\t  sprintf(message, "Temp: %d C \\n\\r", value);\n\n\t\t  LCD_Clear();\n\t\t  LCD_SetCursor(0, 0);\n\t\t  LCD_Print(message);\n\t  }\n}\n\nvoid light(){\n\t  // Replace HAL_Delay(5000) with non-blocking delay\n\t  if ((HAL_GetTick() - ledPreviousTime >= 5000)||(!HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_8))) {\n\t\tif (HAL_GetTick() - ledPreviousTime >= 5000) {\n\t\tledPreviousTime = HAL_GetTick();\n\t\t// Check user button on GPIOA, GPIO_PIN_8\n\t\tHAL_GPIO_WritePin(GPIOA, GPIO_PIN_5, GPIO_PIN_RESET);\n\t\tHAL_GPIO_WritePin(GPIOB, GPIO_PIN_10, GPIO_PIN_SET);}}\n\t  else {\n\t\tHAL_GPIO_WritePin(GPIOA, GPIO_PIN_5, GPIO_PIN_SET);\n\t\tHAL_GPIO_WritePin(GPIOB, GPIO_PIN_10, GPIO_PIN_RESET);\n\t  }\n}\n\nvoid door(){\n\t  // Servo angle control with non-blocking delay\n\t  // Check if object is detected by the IR sensor (connected to GPIOA, GPIO_PIN_6)\n\t  if ((HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_6))||(HAL_GetTick() - servoPreviousTime >= 5000)){\n\t      // If it\'s time to rotate the servo or the servo is already at 180 degrees\n\t      if (HAL_GetTick() - servoPreviousTime >= 5000) {\n\t          servoPreviousTime = HAL_GetTick();  // Reset the timer\n\t          __HAL_TIM_SET_COMPARE(&htim2, TIM_CHANNEL_2, angle(180));  // Set servo to 180 degrees\n\t      }\n\t  } else {\n\t      // No object detected, set the servo to 0 degrees immediately\n\t      __HAL_TIM_SET_COMPARE(&htim2, TIM_CHANNEL_2, angle(0));\n\t  }\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},7020(e,n,t){t.d(n,{A:()=>i});const i=t.p+"assets/images/1-5fc995fb6336f40149bfd997e8ff9bc9.png"},8230(e,n,t){t.d(n,{A:()=>i});const i=t.p+"assets/images/3-a9d6def4d40a187fd228899ab8b3dc4e.png"},8453(e,n,t){t.d(n,{R:()=>l,x:()=>r});var i=t(6540);const o={},s=i.createContext(o);function l(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);